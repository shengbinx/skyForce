function Plane(a,b,c,d,e,f,g,h){this.posX=a,this.posY=b,this.key=c,this.type=d,this.size=e.toUpperCase(),this.normalSrc=f,this.crashSrc=g,this.hitSrc=h,this.hiting=!1,this.crashed=!1,this.imgNode=null,this.width=privateStorage.CONSTANTS.GAME.SIZES.PLANE[this.size].WIDTH,this.height=privateStorage.CONSTANTS.GAME.SIZES.PLANE[this.size].HEIGHT,this.score=privateStorage.CONSTANTS.GAME.SCORES[this.size],this.hp="my"==this.type?0:privateStorage.CONSTANTS.GAME.HP[this.size],this.init()}function Bullet(a,b,c,d){this.posX=a,this.posY=b,this.src=c,this.key=d,this.imgNode=null,this.init()}function setBackground(a,b){a.style.background="url("+b+")"}function keyCreator(a){return"bullet"==a?privateStorage.bulletPrefix+privateStorage.bulletIndex++:"plane"==a?privateStorage.planePrefix+privateStorage.planeIndex++:""}function setScore(a){var b=privateStorage.CONSTANTS.GAME;privateStorage.score=a||0,$("totalScore").innerText=privateStorage.score,$("currentScore").innerText=privateStorage.score,b.DIFFICULTY.LEVEL<5&&privateStorage.score>=b.DIFFICULTY.SCORES[b.DIFFICULTY.LEVEL]&&(b.DIFFICULTY.LEVEL++,b.ENEMY_PLANE_MOVE_STEP++)}function handleOnMyPlaneMove(a){var b=a||window.event,c=privateStorage.CONSTANTS.GAME.SIZES,d=b.clientX-c.STAGE.LEFT,e=b.clientY-c.STAGE.TOP,f=privateStorage.enemyPlanes;privateStorage.myPlane.setPosition(d-parseInt(c.PLANE.MY.WIDTH/2),e-parseInt(c.PLANE.MY.HEIGHT/2));for(var g in f){var h=f[g];pWidth=c.PLANE[h.size].WIDTH,pHeight=c.PLANE[h.size].HEIGHT,e>=h.posY&&e<=h.posY+pHeight&&d<=h.posX+pWidth&&d>=h.posX&&gameOver()}}function handleOnDocumentMove(a){var b=a||window.event,c=privateStorage.CONSTANTS.GAME.SIZES,d=b.clientX,e=b.clientY;e<c.STAGE.TOP||e>c.STAGE.TOP+c.STAGE.HEIGHT||d<c.STAGE.LEFT||d>c.STAGE.LEFT+c.STAGE.WIDTH?"normal"==privateStorage.gameStatus&&pauseGame():"pause"==privateStorage.gameStatus&&resumeGame()}function resetGame(){setScore(0),privateStorage.myPlane=null,privateStorage.bullets={},privateStorage.enemyPlanes={},privateStorage.mainGameNode.innerHTML="",clearInterval(privateStorage.gamer),privateStorage.gamer=null}function gamer(){var a=privateStorage.bullets,b=privateStorage.enemyPlanes,c=privateStorage.CONSTANTS.PLANE_SRC,d=privateStorage.CONSTANTS.GAME,e=privateStorage.CONSTANTS.GAME.SIZES.STAGE.WIDTH;if(privateStorage.planeCreatIndex++,privateStorage.planeCreatIndex==d.ENEMY_PLANE_FREQUENCY){if(privateStorage.planeCreatIndex1++,privateStorage.planeCreatIndex1%parseInt(d.ENEMY_PLANE_FREQUENCY/4)==0){var f=d.SIZES.PLANE.MEDIUM.WIDTH,g=keyCreator("plane"),h=Math.floor(e/f);b[g]=new Plane(Math.floor(Math.random()*h)*f,0,g,"enemy","MEDIUM",c.M_NORMAL_PLANE,c.M_CRASH_PLANE,c.M_HIT_PLANE)}if(privateStorage.planeCreatIndex1==d.ENEMY_PLANE_FREQUENCY){var f=d.SIZES.PLANE.BIG.WIDTH,g=keyCreator("plane"),h=Math.floor(e/f);b[g]=new Plane(Math.floor(Math.random()*h)*f,0,g,"enemy","BIG",c.B_NORMAL_PLANE,c.B_CRASH_PLANE,c.B_HIT_PLANE),privateStorage.planeCreatIndex1=0}else{var f=d.SIZES.PLANE.SMALL.WIDTH,g=keyCreator("plane"),h=Math.floor(e/f);b[g]=new Plane(Math.floor(Math.random()*h)*f,0,g,"enemy","SMALL",c.S_NORMAL_PLANE,c.S_CRASH_PLANE,"")}privateStorage.planeCreatIndex=0}if(privateStorage.planeCreatIndex%parseInt(privateStorage.CONSTANTS.GAME.ENEMY_PLANE_FREQUENCY/4)==0){var i=keyCreator("bullet");a[i]=new Bullet(privateStorage.myPlane.posX+30,privateStorage.myPlane.posY,privateStorage.CONSTANTS.BULLET_SRC,i)}for(var j in b)if(b.hasOwnProperty(j)){var k=b[j],l=privateStorage.myPlane;k instanceof Plane&&(k.moveBackward(),k.posY+k.height>=l.posY&&k.posY+k.height<=l.posY+l.height&&(k.posX>=l.posX&&k.posX<=l.posX+l.width||k.posX+k.width>=l.posX&&k.posX+k.width<=l.posX+l.width)&&gameOver())}for(var m in a)if(a.hasOwnProperty(m)){var n=a[m];n instanceof Bullet&&n.moveForward()}for(var m in a)if(a.hasOwnProperty(m)){var n=a[m];for(var j in b)if(b.hasOwnProperty(j)){var k=b[j],o=privateStorage.CONSTANTS.GAME.SIZES.PLANE[k.size].WIDTH,p=privateStorage.CONSTANTS.GAME.SIZES.PLANE[k.size].HEIGHT;n.posY>=k.posY&&n.posY<=k.posY+p&&n.posX<=k.posX+o&&n.posX>=k.posX&&(n.recycle(),k.hit())}}}function gameOver(){clearInterval(privateStorage.gamer),privateStorage.gamer=null,document.removeEventListener?(privateStorage.mainGameNode.removeEventListener("mousemove",handleOnMyPlaneMove,!0),document.removeEventListener("mousemove",handleOnDocumentMove,!0)):document.detachEvent&&(privateStorage.mainGameNode.detachEvent("mousemove",handleOnMyPlaneMove),document.detachEvent("mousemove",handleOnDocumentMove)),privateStorage.myPlane.changeStatus("crash"),$("endSide").style.display="block"}function startGame(){resetGame(),setBackground(privateStorage.mainGameNode,privateStorage.CONSTANTS.SCENE.BACKGROUND_NORMAL),privateStorage.myPlane=new Plane(127,488,"","my","MY",privateStorage.CONSTANTS.PLANE_SRC.MY_NORMAL_PLANE,privateStorage.CONSTANTS.PLANE_SRC.MY_CRASH_PLANE,""),privateStorage.gamer=setInterval(gamer,privateStorage.CONSTANTS.GAME.FREQUENCY),document.addEventListener?(privateStorage.mainGameNode.addEventListener("mousemove",handleOnMyPlaneMove,!0),document.addEventListener("mousemove",handleOnDocumentMove,!0)):document.attachEvent&&(privateStorage.mainGameNode.attachEvent("mousemove",handleOnMyPlaneMove),document.attachEvent("mousemove",handleOnDocumentMove))}function pauseGame(){clearInterval(privateStorage.gamer),privateStorage.gamer=null,privateStorage.gameStatus="pause",$("pauseSide").style.display="block",document.removeEventListener?privateStorage.mainGameNode.removeEventListener("mousemove",handleOnMyPlaneMove,!0):document.detachEvent&&privateStorage.mainGameNode.detachEvent("mousemove",handleOnMyPlaneMove)}function resumeGame(){privateStorage.gamer=setInterval(gamer,privateStorage.CONSTANTS.GAME.FREQUENCY),privateStorage.gameStatus="normal",$("pauseSide").style.display="none",document.addEventListener?privateStorage.mainGameNode.addEventListener("mousemove",handleOnMyPlaneMove,!0):document.attachEvent&&privateStorage.mainGameNode.attachEvent("mousemove",handleOnMyPlaneMove)}function $(a){return document.getElementById(a)}var privateStorage={CONSTANTS:{PLANE_SRC:{MY_NORMAL_PLANE:"dist/publish/img/plane_my.gif",MY_CRASH_PLANE:"dist/publish/img/crash_my.gif",B_NORMAL_PLANE:"dist/publish/img/plane_b.png",B_HIT_PLANE:"dist/publish/img/hit_b.png",B_CRASH_PLANE:"dist/publish/img/crash_b.gif",M_NORMAL_PLANE:"dist/publish/img/plane_m.png",M_HIT_PLANE:"dist/publish/img/hit_m.png",M_CRASH_PLANE:"dist/publish/img/crash_m.gif",S_NORMAL_PLANE:"dist/publish/img/plane_s.png",S_CRASH_PLANE:"dist/publish/img/crash_s.gif"},BULLET_SRC:"dist/publish/img/bullet.png",SCENE:{BACKGROUND_START:"dist/publish/img/background_start.png",BACKGROUND_NORMAL:"dist/publish/img/background.png"},GAME:{DIFFICULTY:{LEVEL:1,SCORES:{1:1e3,2:2e3,3:5e3,4:1e4,5:5e4}},FREQUENCY:20,PLANE_ANIMATION_DURATION:200,ITEM_CREATE_MULTI:4,ENEMY_PLANE_FREQUENCY:20,MY_PLANE_MOVE_STEP:16,MY_BULLET_MOVE_STEP:20,ENEMY_PLANE_MOVE_STEP:1,HP:{SMALL:10,MEDIUM:20,BIG:50},SCORES:{SMALL:10,MEDIUM:20,BIG:50},SIZES:{STAGE:{WIDTH:320,HEIGHT:568,TOP:100,LEFT:787},PLANE:{MY:{WIDTH:66,HEIGHT:80},SMALL:{WIDTH:34,HEIGHT:24},MEDIUM:{WIDTH:46,HEIGHT:60},BIG:{WIDTH:110,HEIGHT:164}}}}},bullets:{},enemyPlanes:{},gamer:null,myPlane:null,mainGameNode:null,score:0,planeIndex:0,bulletIndex:0,planeCreatIndex:0,planeCreatIndex1:0,planePrefix:"p_",bulletPrefix:"b_",gameStatus:"normal"};Plane.prototype.init=function(){this.imgNode=document.createElement("img"),this.imgNode.setAttribute("class","plane"),this.imgNode.src=this.normalSrc,this.imgNode.style.top=this.posY+"px",this.imgNode.style.left=this.posX+"px",privateStorage.mainGameNode.appendChild(this.imgNode)},Plane.prototype.changeStatus=function(a){var b=this;"normal"==a?b.imgNode.src=b.normalSrc:"hit"==a?(b.hiting=!0,b.imgNode.src=b.hitSrc,setTimeout(function(){b.hiting=!1,!b.crashed&&b.changeStatus("normal")},privateStorage.CONSTANTS.GAME.PLANE_ANIMATION_DURATION)):"crash"==a&&(b.crashed=!0,b.imgNode.src=b.crashSrc,"my"!=b.type&&setTimeout(function(){b.recycle()},privateStorage.CONSTANTS.GAME.PLANE_ANIMATION_DURATION))},Plane.prototype.hit=function(){"enemy"!=this.type||this.crashed||(this.hp-=10,"SMALL"==this.size||this.hiting||this.changeStatus("hit"),this.hp<=0&&(this.changeStatus("crash"),setScore(privateStorage.score+this.score)))},Plane.prototype.setPosition=function(a,b){this.posX=a,this.posY=b,this.imgNode.style.top=b+"px",this.imgNode.style.left=a+"px"},Plane.prototype.recycle=function(){privateStorage.mainGameNode.removeChild(this.imgNode),delete privateStorage.enemyPlanes[this.key]},Plane.prototype.moveBackward=function(){return this.posY+=privateStorage.CONSTANTS.GAME.ENEMY_PLANE_MOVE_STEP,this.posY+this.height>=privateStorage.CONSTANTS.GAME.SIZES.STAGE.HEIGHT?void this.recycle():void(this.imgNode.style.top=this.posY+"px")},Bullet.prototype.init=function(){this.imgNode=document.createElement("img"),this.imgNode.setAttribute("class","bullet"),this.imgNode.src=this.src,this.imgNode.style.top=this.posY+"px",this.imgNode.style.left=this.posX+"px",privateStorage.mainGameNode.appendChild(this.imgNode)},Bullet.prototype.recycle=function(){privateStorage.mainGameNode.removeChild(this.imgNode),delete privateStorage.bullets[this.key]},Bullet.prototype.moveForward=function(){return this.posY-=privateStorage.CONSTANTS.GAME.MY_BULLET_MOVE_STEP,this.posY<=0?void this.recycle():void(this.imgNode.style.top=this.posY+"px")},window.onload=function(){function a(){privateStorage.mainGameNode.removeChild($("startBtn")),startGame()}function b(){$("endSide").style.display="none",startGame()}privateStorage.mainGameNode=$("stageSide"),document.addEventListener?($("startBtn").addEventListener("click",a,!0),$("continueBtn").addEventListener("click",b,!0)):document.attachEvent&&($("startBtn").attachEvent("click",a),$("continueBtn").attachEvent("click",b))};